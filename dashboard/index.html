<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>frost-autofix Â· GitHub Issue è‡ªåŠ¨ä¿®å¤</title>
  <style>
    :root {
      --bg: #050b16;
      --panel: #0f1724;
      --panel-soft: #111c2d;
      --border: #26364e;
      --text: #e6edf7;
      --muted: #93a4bf;
      --primary: #61adff;
      --primary-soft: rgba(97, 173, 255, 0.18);
      --success: #3fd184;
      --danger: #ff6d6d;
      --warning: #f0bb58;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(97, 173, 255, 0.18), transparent 50%),
        radial-gradient(900px 500px at 100% -30%, rgba(63, 209, 132, 0.12), transparent 50%),
        var(--bg);
      min-height: 100vh;
    }

    a { color: var(--primary); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .container { width: min(1120px, 92vw); margin: 0 auto; padding: 1.2rem 0 3rem; }

    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border);
      padding: 0.6rem 0 1rem;
      margin-bottom: 1.8rem;
      gap: 1rem;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-size: 1.8rem;
      font-weight: 800;
      letter-spacing: -0.02em;
      color: var(--primary);
    }

    .nav-links { display: flex; align-items: center; gap: 0.8rem; }

    .nav-links a {
      cursor: pointer;
      color: var(--muted);
      padding: 0.45rem 0.7rem;
      border-radius: 10px;
      border: 1px solid transparent;
    }

    .nav-links a.active,
    .nav-links a:hover {
      color: var(--text);
      border-color: var(--border);
      text-decoration: none;
      background: rgba(255,255,255,0.02);
    }

    .user-menu { display: inline-flex; align-items: center; gap: 0.55rem; }
    .avatar { width: 26px; height: 26px; border-radius: 50%; }

    .btn {
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      border-radius: 10px;
      padding: 0.5rem 0.9rem;
      cursor: pointer;
      font-weight: 600;
    }

    .btn:hover { opacity: 0.92; }
    .btn-primary { background: var(--primary); color: #08111f; border-color: #84c0ff; }
    .btn-outline { background: transparent; border-color: var(--primary); color: var(--primary); }
    .btn-danger { background: transparent; border: 1px solid #6f2e38; color: #ff8a93; font-size: 0.8rem; padding: 0.3rem 0.65rem; }

    .hero {
      text-align: center;
      margin-bottom: 1.6rem;
      padding: 1.4rem 1rem;
      border: 1px solid var(--border);
      border-radius: 20px;
      background: linear-gradient(180deg, rgba(97,173,255,0.1), rgba(97,173,255,0.02));
    }

    .hero h1 { margin: 0 0 0.6rem; font-size: clamp(2rem, 6vw, 3rem); color: var(--primary); }
    .hero p { margin: 0 auto; max-width: 780px; color: var(--muted); line-height: 1.65; }

    .hero-actions { margin-top: 1rem; display: flex; justify-content: center; gap: 0.8rem; flex-wrap: wrap; }

    .stats { display: grid; gap: 0.9rem; grid-template-columns: repeat(4, minmax(0, 1fr)); margin: 1rem 0 1.5rem; }

    .card {
      border: 1px solid var(--border);
      border-radius: 16px;
      background: linear-gradient(180deg, var(--panel-soft), var(--panel));
      padding: 1.05rem;
    }

    .stat-title { color: var(--muted); font-size: 0.9rem; }
    .stat-value { margin-top: 0.3rem; font-size: 2rem; font-weight: 700; color: var(--primary); }

    .section-title {
      margin: 2rem 0 0.9rem;
      font-size: 1.15rem;
      color: #dce8fa;
      letter-spacing: 0.01em;
    }

    .how-it-works { display: grid; gap: 0.9rem; grid-template-columns: repeat(4, minmax(0, 1fr)); }

    .step .num {
      width: 34px;
      height: 34px;
      border-radius: 10px;
      display: inline-grid;
      place-items: center;
      background: var(--primary-soft);
      color: var(--primary);
      font-weight: 700;
    }

    .step h3 { margin: 0.7rem 0 0.35rem; font-size: 1rem; }
    .step p { margin: 0; color: var(--muted); font-size: 0.92rem; line-height: 1.5; }

    .pricing { display: grid; gap: 0.9rem; grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .plan.featured { border-color: #4e9eff; box-shadow: 0 0 0 1px rgba(97,173,255,0.25) inset; }
    .price { font-size: 2rem; color: var(--primary); font-weight: 800; margin: 0.2rem 0 0.55rem; }
    .price span { color: var(--muted); font-size: 1.1rem; font-weight: 500; }

    .plan ul { list-style: none; padding: 0; margin: 0; display: grid; gap: 0.45rem; }
    .plan li { color: var(--muted); font-size: 0.92rem; }
    .plan li::before { content: "âœ“ "; color: var(--success); }

    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
    }

    th, td { text-align: left; padding: 0.75rem 0.85rem; border-bottom: 1px solid rgba(147,164,191,0.18); font-size: 0.9rem; }
    th { color: var(--muted); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.06em; }

    .badge {
      display: inline-block;
      font-size: 0.73rem;
      font-weight: 700;
      border-radius: 999px;
      padding: 0.2rem 0.55rem;
      border: 1px solid transparent;
      text-transform: uppercase;
    }

    .badge-success { color: #85f5b8; border-color: rgba(63,209,132,0.4); background: rgba(63,209,132,0.14); }
    .badge-failed { color: #ffb0b0; border-color: rgba(255,109,109,0.45); background: rgba(255,109,109,0.12); }
    .badge-processing { color: #ffd796; border-color: rgba(240,187,88,0.45); background: rgba(240,187,88,0.12); }
    .badge-queued { color: #b5d7ff; border-color: rgba(97,173,255,0.45); background: rgba(97,173,255,0.12); }

    .empty { text-align: center; color: var(--muted); padding: 1.5rem; }

    .install-card { border: 1px solid var(--border); border-radius: 14px; padding: 1rem; background: var(--panel); margin-bottom: 0.8rem; }
    .install-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
    .account { font-weight: 700; }

    .plan-badge { border-radius: 999px; padding: 0.2rem 0.6rem; font-size: 0.74rem; font-weight: 700; text-transform: uppercase; }
    .plan-free { color: #b5d7ff; background: rgba(97,173,255,0.16); }
    .plan-pro { color: #9ef2c6; background: rgba(63,209,132,0.16); }

    .usage-text { color: var(--muted); font-size: 0.86rem; margin-bottom: 0.35rem; }
    .usage-bar-wrap { height: 8px; border-radius: 999px; background: #1b2738; overflow: hidden; }
    .usage-bar { height: 100%; }
    .usage-bar.ok { background: var(--success); }
    .usage-bar.warn { background: var(--warning); }
    .usage-bar.full { background: var(--danger); }

    .page { display: none; }
    .page.active { display: block; }

    footer {
      text-align: center;
      margin-top: 2.5rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
      color: var(--muted);
      font-size: 0.84rem;
    }

    @media (max-width: 1000px) {
      .stats { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .how-it-works { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .pricing { grid-template-columns: 1fr; }
    }

    @media (max-width: 640px) {
      .container { width: min(94vw, 1120px); }
      nav { flex-wrap: wrap; }
      .brand { font-size: 1.45rem; }
      .stats, .how-it-works { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <nav>
      <div class="brand">ğŸ§Š frost-autofix</div>
      <div class="nav-links">
        <a onclick="showPage('home')" id="nav-home" class="active">é¦–é¡µ</a>
        <a onclick="showPage('dashboard')" id="nav-dashboard" style="display:none">æ§åˆ¶å°</a>
        <div id="auth-area"></div>
      </div>
    </nav>

    <div class="page active" id="page-home">
      <section class="hero">
        <h1>ğŸ§Š frost-autofix</h1>
        <p>
          ä¸“æ³¨ä¿®å¤ GitHub é—®é¢˜å•çš„ AI Agentï¼šç›‘å¬ bug issueã€åˆ†ææ ¹å› ã€ç”Ÿæˆæœ€å°ä¿®å¤ PRã€‚
          ä½ åªéœ€è¦å®‰è£… Appï¼Œå‰©ä¸‹çš„è‡ªåŠ¨è¿›è¡Œã€‚
        </p>
        <div class="hero-actions">
          <a class="btn btn-primary" href="https://github.com/apps/frost-autofix" target="_blank">å®‰è£…åˆ° GitHub</a>
          <a class="btn btn-outline" href="https://github.com/stakeswky/frost-autofix" target="_blank">æŸ¥çœ‹æºç </a>
        </div>
      </section>

      <section class="stats">
        <article class="card"><div class="stat-title">å®‰è£…æ•°</div><div class="stat-value" id="s-installs">â€”</div></article>
        <article class="card"><div class="stat-title">ä¿®å¤å°è¯•</div><div class="stat-value" id="s-runs">â€”</div></article>
        <article class="card"><div class="stat-title">åˆ›å»º PR</div><div class="stat-value" id="s-prs">â€”</div></article>
        <article class="card"><div class="stat-title">æˆåŠŸç‡</div><div class="stat-value" id="s-rate">â€”</div></article>
      </section>

      <h2 class="section-title">å·¥ä½œæµç¨‹</h2>
      <section class="how-it-works">
        <article class="card step"><div class="num">1</div><h3>å®‰è£… App</h3><p>åœ¨ç»„ç»‡æˆ–ä»“åº“ä¸­å®‰è£… frost-autofix å¹¶æˆæƒè®¿é—®ã€‚</p></article>
        <article class="card step"><div class="num">2</div><h3>è§¦å‘ä¿®å¤</h3><p>å‡ºç° bug issueï¼ˆæˆ–è¯„è®º <code>/fix</code>ï¼‰åè‡ªåŠ¨è¿›å…¥é˜Ÿåˆ—ã€‚</p></article>
        <article class="card step"><div class="num">3</div><h3>AI åˆ†æ</h3><p>å®šä½æ ¹å› ï¼Œäº§å‡ºæœ€å°æ”¹åŠ¨å¹¶ä¿ç•™é¡¹ç›®é£æ ¼ã€‚</p></article>
        <article class="card step"><div class="num">4</div><h3>æäº¤ PR</h3><p>è‡ªåŠ¨åˆ›å»ºä¿®å¤ PRï¼Œä¿ç•™ä¸Šä¸‹æ–‡ä¸å¯è¿½è¸ªå†å²ã€‚</p></article>
      </section>

      <h2 class="section-title">ä»·æ ¼æ–¹æ¡ˆ</h2>
      <section class="pricing">
        <article class="card plan">
          <h3>Free</h3>
          <div class="price">$0 <span>/month</span></div>
          <ul>
            <li>æ¯æœˆ 5 ä¸ªè‡ªåŠ¨ä¿®å¤ PR</li>
            <li>ä»…å…¬å¼€ä»“åº“</li>
            <li>ç¤¾åŒºæ”¯æŒ</li>
          </ul>
        </article>
        <article class="card plan featured">
          <h3>Pro</h3>
          <div class="price">$29 <span>/month</span></div>
          <ul>
            <li>æ— é™ PR</li>
            <li>æ”¯æŒç§æœ‰ä»“åº“</li>
            <li>ä¼˜å…ˆé˜Ÿåˆ—ä¸æ›´å¿«å¤„ç†</li>
            <li>ä¸“å±æ”¯æŒ</li>
          </ul>
        </article>
      </section>

      <h2 class="section-title">è¿‘æœŸæ´»åŠ¨</h2>
      <div id="activity" style="display:none">
        <table>
          <thead><tr><th>ä»“åº“</th><th>Issue</th><th>PR</th><th>çŠ¶æ€</th><th>æ—¶é—´</th></tr></thead>
          <tbody id="activity-body"></tbody>
        </table>
      </div>
      <div id="loading" class="empty">æ­£åœ¨åŠ è½½ç»Ÿè®¡æ•°æ®...</div>
    </div>

    <div class="page" id="page-dashboard">
      <h2 class="section-title">ä½ çš„å®‰è£…åˆ—è¡¨</h2>
      <div id="dash-installations"><div class="empty">åŠ è½½ä¸­...</div></div>

      <h2 class="section-title">ä½ çš„ä¿®å¤å†å²</h2>
      <div id="dash-runs"><div class="empty">åŠ è½½ä¸­...</div></div>

      <h2 class="section-title">æœˆåº¦ç”¨é‡</h2>
      <div id="dash-usage"><div class="empty">åŠ è½½ä¸­...</div></div>
    </div>

    <footer>
      frost-autofix Â· Built by <a href="https://github.com/stakeswky">stakeswky</a>
    </footer>
  </div>

  <script>
    const API = "https://frost-autofix.stawky.workers.dev";
    const MOCK_MODE = new URLSearchParams(window.location.search).get("mock") === "1";
    let currentUser = null;

    const MOCK_DATA = {
      user: {
        login: "demo-user",
        avatar: "https://avatars.githubusercontent.com/u/583231?v=4",
        user_id: 10001
      },
      stats: {
        installations: 42,
        total_runs: 368,
        prs_created: 291,
        success_rate: 79,
        recent: [
          { repo: "demo-org/api-service", issue_number: 123, pr_number: 456, status: "success", created_at: "2026-02-21T08:30:00Z" },
          { repo: "demo-org/web-app", issue_number: 87, pr_number: null, status: "processing", created_at: "2026-02-22T10:45:00Z" },
          { repo: "demo-org/infra", issue_number: 51, pr_number: null, status: "failed", created_at: "2026-02-23T12:00:00Z" }
        ]
      },
      installations: [
        { account_login: "demo-org", plan: "pro", current_month_prs: 18, pr_limit: -1 },
        { account_login: "opensource-lab", plan: "free", current_month_prs: 4, pr_limit: 5 }
      ],
      runs: [
        { repo: "demo-org/api-service", issue_number: 123, pr_number: 456, status: "success", created_at: "2026-02-21T08:30:00Z" },
        { repo: "demo-org/web-app", issue_number: 87, pr_number: null, status: "processing", created_at: "2026-02-22T10:45:00Z" },
        { repo: "demo-org/infra", issue_number: 51, pr_number: null, status: "failed", created_at: "2026-02-23T12:00:00Z" }
      ],
      usage: [
        { account_login: "demo-org", month: "2026-02", pr_count: 18 },
        { account_login: "opensource-lab", month: "2026-02", pr_count: 4 }
      ]
    };

    async function checkAuth() {
      if (MOCK_MODE) {
        currentUser = MOCK_DATA.user;
        updateAuthUI(currentUser);
        if (!window.location.hash.includes("dashboard")) window.location.hash = "#dashboard";
        showPage("dashboard");
        return;
      }

      try {
        const hash = window.location.hash;
        const tokenMatch = hash.match(/token=([^&]+)/);
        if (tokenMatch) {
          localStorage.setItem("frost_token", tokenMatch[1]);
          window.location.hash = hash.replace(/token=[^&]+&?/, "").replace(/^#\/?$/, "");
        }

        const token = localStorage.getItem("frost_token");
        if (!token) return updateAuthUI(null);

        const res = await fetch(`${API}/api/me`, {
          headers: { Authorization: `Bearer ${token}` },
        });

        if (!res.ok) {
          localStorage.removeItem("frost_token");
          return updateAuthUI(null);
        }

        currentUser = await res.json();
        updateAuthUI(currentUser);

        if (window.location.hash.includes("dashboard")) showPage("dashboard");
      } catch (e) {
        updateAuthUI(null);
      }
    }

    function updateAuthUI(user) {
      const area = document.getElementById("auth-area");
      const dashNav = document.getElementById("nav-dashboard");
      if (user) {
        dashNav.style.display = "";
        area.innerHTML = `
          <span class="user-menu">
            <img src="${user.avatar}" class="avatar" alt="${user.login}">
            <span style="font-size:0.9rem">${user.login}</span>
            <button class="btn-danger" onclick="logout()">é€€å‡º</button>
          </span>`;
      } else {
        dashNav.style.display = "none";
        area.innerHTML = `<a href="${API}/auth/login" class="btn btn-outline" style="font-size:0.85rem">GitHub ç™»å½•</a>`;
      }
    }

    async function logout() {
      const token = localStorage.getItem("frost_token");
      if (token) {
        fetch(`${API}/auth/logout`, {
          method: "POST",
          headers: { Authorization: `Bearer ${token}` },
        }).catch(() => {});
      }
      localStorage.removeItem("frost_token");
      currentUser = null;
      updateAuthUI(null);
      showPage("home");
    }

    function showPage(name) {
      document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
      document.querySelectorAll(".nav-links a").forEach(a => a.classList.remove("active"));
      const page = document.getElementById(`page-${name}`);
      const nav = document.getElementById(`nav-${name}`);
      if (page) page.classList.add("active");
      if (nav) nav.classList.add("active");

      if (name === "dashboard" && currentUser) loadDashboard();
      if (name === "home") loadPublicStats();
    }

    async function loadPublicStats() {
      try {
        const d = MOCK_MODE ? MOCK_DATA.stats : await (await fetch(`${API}/api/stats`)).json();
        document.getElementById("s-installs").textContent = d.installations;
        document.getElementById("s-runs").textContent = d.total_runs;
        document.getElementById("s-prs").textContent = d.prs_created;
        document.getElementById("s-rate").textContent = d.success_rate + "%";

        const tbody = document.getElementById("activity-body");
        tbody.innerHTML = "";
        if (d.recent?.length) {
          d.recent.forEach(r => {
            const tr = document.createElement("tr");
            const cls = r.status === "success" ? "badge-success" : r.status === "failed" ? "badge-failed" : r.status === "processing" ? "badge-processing" : "badge-queued";
            tr.innerHTML = `
              <td><a href="https://github.com/${r.repo}">${r.repo}</a></td>
              <td>#${r.issue_number}</td>
              <td>${r.pr_number ? `<a href="https://github.com/${r.repo}/pull/${r.pr_number}" style="color:var(--success)">#${r.pr_number}</a>` : "â€”"}</td>
              <td><span class="badge ${cls}">${r.status}</span></td>
              <td>${new Date(r.created_at).toLocaleDateString()}</td>`;
            tbody.appendChild(tr);
          });
          document.getElementById("activity").style.display = "";
        }
        document.getElementById("loading").style.display = "none";
      } catch (e) {
        document.getElementById("loading").textContent = "ç»Ÿè®¡åŠ è½½å¤±è´¥";
      }
    }

    async function loadDashboard() {
      const token = localStorage.getItem("frost_token");
      const headers = { Authorization: `Bearer ${token}` };

      try {
        const data = MOCK_MODE ? { installations: MOCK_DATA.installations } : await (await fetch(`${API}/api/my/installations`, { headers })).json();
        const el = document.getElementById("dash-installations");
        if (!data.installations?.length) {
          el.innerHTML = `<div class="empty">æš‚æ— å®‰è£…è®°å½•ã€‚<a href="https://github.com/apps/frost-autofix" target="_blank">å»å®‰è£… â†’</a></div>`;
        } else {
          el.innerHTML = data.installations.map(inst => {
            const pct = inst.pr_limit > 0 ? Math.min(100, Math.round((inst.current_month_prs / inst.pr_limit) * 100)) : 0;
            const barClass = pct >= 100 ? "full" : pct >= 80 ? "warn" : "ok";
            return `
              <div class="install-card">
                <div class="install-header">
                  <span class="account">${inst.account_login}</span>
                  <span class="plan-badge plan-${inst.plan}">${inst.plan}</span>
                </div>
                <div class="usage-text">æœ¬æœˆ ${inst.current_month_prs} / ${inst.pr_limit === -1 ? "âˆ" : inst.pr_limit} PR</div>
                ${inst.pr_limit > 0 ? `<div class="usage-bar-wrap"><div class="usage-bar ${barClass}" style="width:${pct}%"></div></div>` : ""}
              </div>`;
          }).join("");
        }
      } catch (e) {
        document.getElementById("dash-installations").innerHTML = `<div class="empty">å®‰è£…æ•°æ®åŠ è½½å¤±è´¥</div>`;
      }

      try {
        const data = MOCK_MODE ? { runs: MOCK_DATA.runs } : await (await fetch(`${API}/api/my/runs`, { headers })).json();
        const el = document.getElementById("dash-runs");
        if (!data.runs?.length) {
          el.innerHTML = `<div class="empty">æš‚æ— ä¿®å¤è®°å½•</div>`;
        } else {
          let html = `<table><thead><tr><th>ä»“åº“</th><th>Issue</th><th>PR</th><th>çŠ¶æ€</th><th>æ—¥æœŸ</th></tr></thead><tbody>`;
          data.runs.forEach(r => {
            const cls = r.status === "success" ? "badge-success" : r.status === "failed" ? "badge-failed" : r.status === "processing" ? "badge-processing" : "badge-queued";
            html += `<tr>
              <td><a href="https://github.com/${r.repo}">${r.repo}</a></td>
              <td><a href="https://github.com/${r.repo}/issues/${r.issue_number}">#${r.issue_number}</a></td>
              <td>${r.pr_number ? `<a href="https://github.com/${r.repo}/pull/${r.pr_number}" style="color:var(--success)">#${r.pr_number}</a>` : "â€”"}</td>
              <td><span class="badge ${cls}">${r.status}</span></td>
              <td>${new Date(r.created_at).toLocaleDateString()}</td>
            </tr>`;
          });
          html += `</tbody></table>`;
          el.innerHTML = html;
        }
      } catch (e) {
        document.getElementById("dash-runs").innerHTML = `<div class="empty">ä¿®å¤å†å²åŠ è½½å¤±è´¥</div>`;
      }

      try {
        const data = MOCK_MODE ? { usage: MOCK_DATA.usage } : await (await fetch(`${API}/api/my/usage`, { headers })).json();
        const el = document.getElementById("dash-usage");
        if (!data.usage?.length) {
          el.innerHTML = `<div class="empty">æš‚æ— ç”¨é‡æ•°æ®</div>`;
        } else {
          let html = `<table><thead><tr><th>è´¦å·</th><th>æœˆä»½</th><th>PR æ•°</th></tr></thead><tbody>`;
          data.usage.forEach(u => {
            html += `<tr><td>${u.account_login}</td><td>${u.month}</td><td>${u.pr_count}</td></tr>`;
          });
          html += `</tbody></table>`;
          el.innerHTML = html;
        }
      } catch (e) {
        document.getElementById("dash-usage").innerHTML = `<div class="empty">ç”¨é‡æ•°æ®åŠ è½½å¤±è´¥</div>`;
      }
    }

    checkAuth();
    loadPublicStats();
  </script>
</body>
</html>
